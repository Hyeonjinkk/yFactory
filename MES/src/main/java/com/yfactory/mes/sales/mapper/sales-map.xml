<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yfactory.mes.sales.mapper.SalesMapper">

	<!-- 주문서 조회 -->
	<select id="selectOrderList" resultType="map">
		SELECT ord.ord_cd  "주문코드" , 
					   TO_CHAR(ord.req_dt,'YYYY-MM-DD') "주문일자",
					   TO_CHAR(ord.res_dt,'YYYY-MM-DD') "납기일자",
					   ordtl.prod_cd "완제품코드" ,
					   ordtl.ord_qty "주문수량",
					   vdr.vdr_nm "업체명",
					   pd.prod_nm "완제품명",
					   cd.cd_explan "진행상황"
		FROM 
					   ORDERS ord, 
					   VENDOR vdr, 
					   ORD_DTL ordtl, 
					   PROD pd, 
					   COMM_CODE cd
	WHERE     ord.vdr_cd = vdr.vdr_cd
		AND      ord.ord_cd = ordtl.ord_cd
		AND      ordtl.prod_cd = pd.prod_cd
		AND      cd.comm_cd = ord.prog_cd
		
	</select>
	
	<!-- BOM 조회 -->
	<select id="selectBomList" resultType="map">
	SELECT 		b.prod_cd "완제품코드",
				   		pd.prod_nm "완제품명", 
				 		b.mt_cd "원자재 코드", 
				  		m.mt_nm "원자재명", 
				 		b.cs_qty "소요량"
	FROM 		    bom b,
			            prod pd, 
			            mt m
	WHERE 		b.prod_cd = pd.prod_cd
	AND 			b.mt_cd = m.mt_cd
	</select>
	
	<!-- 주문서 검색 -->
	<select id="searchOrderList" resultType="map">
	SELECT ord.ord_cd  "주문코드" , 
					   TO_CHAR(ord.req_dt,'YYYY-MM-DD') "주문일자",
					   TO_CHAR(ord.res_dt,'YYYY-MM-DD') "납기일자",
					   ordtl.prod_cd "완제품코드" ,
					   ordtl.ord_qty "주문수량",
					   vdr.vdr_nm "업체명",
					   pd.prod_nm "완제품명",
					   cd.cd_explan "진행상황"
		FROM 
					   ORDERS ord, 
					   VENDOR vdr, 
					   ORD_DTL ordtl, 
					   PROD pd, 
					   COMM_CODE cd
	WHERE     ord.vdr_cd = vdr.vdr_cd
		AND      ord.ord_cd = ordtl.ord_cd
		AND      ordtl.prod_cd = pd.prod_cd
		AND      cd.comm_cd = ord.prog_cd		
		<if test="pcd != ''">
        AND      pd.prod_cd LIKE #{pcd}
        </if>       
        <if test="pcd == '' and pnm != ''">
        AND      pd.prod_nm LIKE #{pnm}
        </if>        
        <if test="vnm != ''">
        AND      vdr.vdr_cd LIKE '%'||#{vcd}||'%'
        </if>
        <if test="vcd == '' and vnm != ''">
        AND      vdr.vdr_nm LIKE '%'||#{vnm}||'%'
        </if>
        <if test="req1 != '' and req2 != ''">        
        AND      ord.req_dt between TO_DATE(#{req1},'YYYY-MM-DD') AND TO_DATE(#{req2},'YYYY-MM-DD')
        </if>
        <if test="res1 != '' and res2 != ''">
        AND      ord.res_dt between TO_DATE(#{res1},'YYYY-MM-DD') AND TO_DATE(#{res2},'YYYY-MM-DD')
        </if>
        <if test="key == 1">
        AND      cd_explan LIKE '주문접수'
        </if>
        <if test="key == 2">
        AND      cd_explan LIKE '출고처리완료'
        </if>
        <if test="key == 3">        
        </if>
	</select>
	
	<!-- 완제품LOT조회 -->
	<select id="selectProdLotList" resultType="map">
		SELECT		pdlot.prod_lot AS "완제품LOT",
					pdlot.prod_cd AS "제품코드",
					pd.prod_nm AS "제품명",
					pdc.prod_qty AS "완제품수량",
        			TO_CHAR(pdlot.prod_fdt,'YYYY-MM-DD') AS "제조일자",
        			TO_CHAR(pdlot.prod_exp,'YYYY-MM-DD') AS "유통기한"
		FROM		prod pd, prod_lot pdlot, prod_curqty pdc
		WHERE		pd.prod_cd = pdlot.prod_cd
		AND     	pdlot.prod_lot = pdc.prod_lot
	</select>
	
	<!-- 완제품LOT검색 -->
	<select id="searchProdLotList" resultType="map">
		SELECT		pdlot.prod_lot AS "완제품LOT",
					pdlot.prod_cd AS "제품코드",
					pd.prod_nm AS "제품명",
					pdc.prod_qty AS "완제품수량",
        			TO_CHAR(pdlot.prod_fdt,'YYYY-MM-DD') AS "제조일자",
        			TO_CHAR(pdlot.prod_exp,'YYYY-MM-DD') AS "유통기한"
		FROM		prod pd, prod_lot pdlot, prod_curqty pdc
		WHERE		pd.prod_cd = pdlot.prod_cd
		AND     	pdlot.prod_lot = pdc.prod_lot
		<if test="pcd != ''">
		AND			pdlot.prod_cd LIKE #{pcd}
		</if>
		<if test="pcd == '' and pnm != ''">
		AND		    pd.prod_nm LIKE #{pnm}
		</if>		
		<if test="fdt1 != '' and fdt2 != ''">
		AND		    pdlot.prod_fdt between TO_DATE(#{fdt1},'YYYY-MM-DD') AND TO_DATE(#{fdt2},'YYYY-MM-DD')			
		</if>
	</select>
	
	<!-- 완제품modal리스트 -->
	<select id="prodModalList" resultType="map">
		SELECT 		prod_nm AS "제품명",
					prod_cd AS "제품코드"
		FROM   		prod	
	</select>
	
	<!-- 완제품modal 검색 -->
	<select id="prodModalSearch" resultType="map">
		SELECT 		prod_nm AS "제품명",
					prod_cd AS "제품코드"
		FROM   		prod
		WHERE		prod_nm LIKE '%'||#{key}||'%'
	</select>
	
</mapper>