<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yfactory.mes.sales.mapper.SalesMapper">

	<select id="selectOrderList" resultType="map">
		SELECT ord.ord_cd  "주문코드" , 
					   TO_CHAR(ord.req_dt,'YYYY-MM-DD') "주문일자",
					   TO_CHAR(ord.res_dt,'YYYY-MM-DD') "납기일자",
					   ordtl.prod_cd "완제품코드" ,
					   ordtl.ord_qty "주문수량",
					   vdr.vdr_nm "업체명",
					   pd.prod_nm "완제품명",
					   cd.cd_explan "진행상황"
		FROM 
					   ORDERS ord, 
					   VENDOR vdr, 
					   ORD_DTL ordtl, 
					   PROD pd, 
					   COMM_CODE cd
	WHERE     ord.vdr_cd = vdr.vdr_cd
		AND      ord.ord_cd = ordtl.ord_cd
		AND      ordtl.prod_cd = pd.prod_cd
		AND      cd.comm_cd = ord.prog_cd
	</select>

	<select id="selectBomList" resultType="map">
	SELECT 		b.prod_cd "완제품코드",
				   		pd.prod_nm "완제품명", 
				 		b.mt_cd "원자재 코드", 
				  		m.mt_nm "원자재명", 
				 		b.cs_qty "소요량"
	FROM 		    bom b,
			            prod pd, 
			            mt m
	WHERE 		b.prod_cd = pd.prod_cd
	AND 			b.mt_cd = m.mt_cd
	</select>
	
	<select id="searchOrderList" resultType="map">
	SELECT ord.ord_cd  "주문코드" , 
					   TO_CHAR(ord.req_dt,'YYYY-MM-DD') "주문일자",
					   TO_CHAR(ord.res_dt,'YYYY-MM-DD') "납기일자",
					   ordtl.prod_cd "완제품코드" ,
					   ordtl.ord_qty "주문수량",
					   vdr.vdr_nm "업체명",
					   pd.prod_nm "완제품명",
					   cd.cd_explan "진행상황"
		FROM 
					   ORDERS ord, 
					   VENDOR vdr, 
					   ORD_DTL ordtl, 
					   PROD pd, 
					   COMM_CODE cd
	WHERE     ord.vdr_cd = vdr.vdr_cd
		AND      ord.ord_cd = ordtl.ord_cd
		AND      ordtl.prod_cd = pd.prod_cd
		AND      cd.comm_cd = ord.prog_cd		
		<if test="pnm != ''">
        AND      pd.prod_nm LIKE #{pnm}
        </if>       
        <if test="vnm != ''">
        AND      vdr.vdr_nm LIKE '%'||#{vnm}||'%'
        </if>
        <if test="req1 != '' and req2 != ''">        
        AND      ord.req_dt between TO_DATE(#{req1},'YYYY-MM-DD') AND TO_DATE(#{req2},'YYYY-MM-DD')
        </if>
        <if test="res1 != '' and res2 != ''">
        AND      ord.res_dt between TO_DATE(#{res1},'YYYY-MM-DD') AND TO_DATE(#{res2},'YYYY-MM-DD')
        </if>
        <!-- <if test="exp == '1'">
        AND      cd_explan = 주문접수
        </if>
        <if test="exp == '2'">
        AND      cd_explan = 출고완료
        </if>
        <if test="exp == '3'">
        AND      cd_explan = 주문접수
        OR		 cd_explan = 출고완료
        </if> -->
	</select>
</mapper>