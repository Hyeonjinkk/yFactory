<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yfactory.mes.quality.mapper.QualityMapper">
	<!-- 조회 -->
	<!-- 자재 품질검사요청(modal) 조회 -->
	<select id="selectpoDtlRequest" resultType="map">
		SELECT 
		        MPD.PO_DTLCD as "발주상세코드",
		        MT.MT_CD as "자재코드",
		        MT.MT_NM as "자재명",
		        VDR.VDR_NM as "업체명",
		        MPD.PO_QTY as "발주량"
		FROM 	MT_PODTL MPD, MT MT, VENDOR VDR, MT_PO MP
		WHERE 	MPD.PO_CD = MP.PO_CD
		AND     MP.MT_CD = MT.MT_CD
		AND     MP.VDR_CD = VDR.VDR_CD
	</select>
	<!-- 제품 품질검사요청(modal) 조회 -->
	
	<!-- 자재 품질검사요청 -->
	
	
	<!-- 자재검사관리 조회 -->
	<select id="selectMtCheckMgr" resultType="map">
		SELECT 	MPD.PO_DTLCD "발주상세코드", MT.MT_CD "자재코드", 
				MT.MT_NM "자재명", MPD.PO_QTY "발주량", CC.CD_NM "상태"
		FROM 	MT_PODTL MPD, MT_PO MP, MT MT, COMM_CODE CC, MT_CHK CHK
		WHERE 	MPD.PO_CD = MP.PO_CD
		AND 	MP.MT_CD = MT.MT_CD
		AND 	CHK.PO_DTLCD = MPD.PO_DTLCD
		AND 	CHK.CHK_INSP = CC.COMM_CD
		AND 	COMM_CD = 'MTRL01'
	</select>
	<!-- 제품검사관리 조회 -->
	<select id="selectProdCheckMgr" resultType="map">
		SELECT	PER.PROD_LOT AS "제품LOT", P.PROD_CD AS "제품코드", P.PROD_NM AS "제품명",
				PC.PROC_CD AS "공정코드", PC.EQ_CD AS "설비코드", PS.PROC_QTY AS "생산량",
				PE.ERR_CD AS "불량코드", ERR.ERR_DTL AS "불량명", PS.PROC_ST AS "상태"
		
		FROM	PROD_ERR PER, PROD_LOT PLO, PRD_INSDTL PID, PROC_PRC PPR, PROD P,
				PROCESS PC, PROC_ST PS, PROC_ERR PE, ERR_CODE ERR
		
		WHERE	PID.PROD_CD = P.PROD_CD
		AND 	PPR.PRD_DTLCD = PID.PRD_DTLCD
		AND		PPR.PROC_CD = PC.PROC_CD
		AND 	PS.PROC_PRCD = PPR.PROC_PRCD
		AND 	PS.LINE_TURN = PPR.LINE_TURN
		AND 	PS.PRD_DTLCD = PPR.PRD_DTLCD
		AND 	PE.PROC_PRCD = PPR.PROC_PRCD
		AND 	PE.LINE_TURN = PPR.LINE_TURN
		AND 	PE.PRD_DTLCD = PPR.PRD_DTLCD
		AND 	PE.ERR_CD = ERR.ERR_CD
	</select>
	
	<!-- 자재검사결과 조회 -->
	<select id="selectMtCheck" resultType="map">
		SELECT	MPD.PO_DTLCD "발주상세코드", MT.MT_CD "자재코드", MT.MT_NM "자재명", 
				TO_CHAR(CHK.CHK_DT, 'YYYY-MM-DD') "검사일자", MPD.PO_QTY "발주량", CHK.CHK_PASSQTY "합격량", MEL.CHK_ERRQTY "불량량",
				MEL.ERR_CD "불량코드", ERR.ERR_DTL "불량내역", CC.CD_NM "상태"
		FROM	MT_CHK CHK, MT_PODTL MPD, MT MT, MT_ERRLIST MEL, ERR_CODE ERR, COMM_CODE CC
		WHERE	CHK.PO_DTLCD = MPD.PO_DTLCD
		AND		CHK.MTRL_CD = MT.MT_CD
		AND		MEL.PO_DTLCD = MPD.PO_DTLCD
		AND 	MEL.ERR_CD = ERR.ERR_CD
		AND 	CHK.CHK_INSP = CC.COMM_CD
		AND 	COMM_CD != 'MTRL01'
	</select>
	<!-- 제품검사결과 조회 -->
	<select id="selectProdCheck" resultType="map">
		SELECT	per.prod_lot as "제품LOT",
				pid.prod_cd as "제품코드",
				p.prod_nm as "제품명",
				ppr.proc_cd as "공정코드",
				pc.eq_cd as "설비코드",
				ps.proc_qty as "생산량",
				ps.proc_passqty as "합격량",
				pe.err_qty as "불량량",
				pe.err_cd as "불량코드",
				err.err_dtl as "불량내역",
				ps.proc_st as "상태"
		
		FROM 	prod_err per,
				prod_lot plo,
				prd_insdtl pid,
				proc_prc ppr,
				process pc,
				prod p,
				proc_st ps,
				proc_err pe,
				err_code err
		
		WHERE 	per.prod_lot = plo.prod_lot
		AND 	ppr.prd_dtlcd = pid.prd_dtlcd
		AND 	ppr.proc_cd = pc.proc_cd
		AND 	pid.prod_cd = p.prod_cd
		AND 	ps.proc_prcd = ppr.proc_prcd
		AND 	ps.line_turn = ppr.line_turn
		AND 	ps.prd_dtlcd = ppr.prd_dtlcd
		AND 	pe.proc_prcd = ppr.proc_prcd
		AND 	pe.line_turn = ppr.line_turn
		AND 	pe.prd_dtlcd = ppr.prd_dtlcd
		AND 	pe.err_cd = err.err_cd
	</select>
	<!-- 자재불량내역 조회 -->
	<select id="selectMtErrList" resultType="map">
		SELECT	mel.po_dtlcd as "발주상세코드",
				chk.chk_dt as "검사일자",
				v.vdr_nm as "업체명",
				mt.mt_nm as "자재명",
				mel.chk_errqty as "불량량",
				err.err_dtl as "불량내역",
				mpd.mt_prc as "단가"
		
		FROM 	mt_chk chk,
				mt_podtl mpd,
				mt_po po,
				vendor v,
				mt_errlist mel,
				err_code err,
				mt mt
		
		WHERE 	mel.po_dtlcd = mpd.po_dtlcd
		AND		mpd.po_cd = po.po_cd
		AND 	po.vdr_cd = v.vdr_cd
		AND 	mel.mtrl_cd = mt.mt_cd
		AND 	mel.err_cd = err.err_cd
	</select>
	<!-- 제품불량내역 조회 -->
	<select id="selectProdErrList" resultType="map">
		SELECT	per.prod_lot as "제품LOT",
				ppr.proc_cd as "공정코드",
				pe.line_turn as "순번",
				p.prod_nm as "제품명",
				per.chk_errqty as "불량량",
				pe.err_cd as "불량코드",
				err.err_dtl as "불량내역",
				ps.proc_st as "상태"
		
		FROM 	prod_err per,
				prod_lot plo,
				prd_insdtl pid,
				proc_prc ppr,
				proc_st ps,
				proc_err pe,
				err_code err,
				prod p
		
		WHERE	per.prod_lot = plo.prod_lot
		AND		pid.prod_cd = p.prod_cd
		AND 	ps.proc_prcd = ppr.proc_prcd
		AND 	ps.line_turn = ppr.line_turn
		AND 	ps.prd_dtlcd = ppr.prd_dtlcd
		AND 	pe.proc_prcd = ppr.proc_prcd
		AND 	pe.line_turn = ppr.line_turn
		AND 	pe.prd_dtlcd = ppr.prd_dtlcd
		AND 	pe.err_cd = err.err_cd
	</select>

	<!-- 검색 -->
	<!-- 자재 품질검사요청(modal) 조회 -->
	<select id="searchpoDtlRequest" resultType="map">
		SELECT	mpd.po_dtlcd as "발주상세코드",
				mp.mt_cd as "자재코드",
				mt.mt_nm as "자재명",
				vdr.vdr_nm as "업체명",
				mpd.po_qty "발주량"
		FROM	mt_podtl mpd,
				mt_po mp,
				mt mt,
				vendor vdr
		WHERE	mpd.po_cd = mp.po_cd
		AND		mp.mt_cd = mt.mt_cd
		AND 	mp.vdr_cd = vdr.vdr_cd
		<if test="mtName != ''">
		AND 	mt.mt_nm LIKE '%' || #{mtName} || '%'
		</if>
	</select>
	<!-- 자재검사결과 검색 -->
	<select id="searchMtQuality" resultType="map">
		SELECT  chk.po_dtlcd as "발주상세코드",
		        chk.chk_dt as "검사일자",
		        v.vdr_nm as "업체명",
		        mt.mt_nm as "자재명",
		        mt.mt_unit as "관리단위",
		        mpd.po_qty as "발주량",
		        chk.chk_passqty as "합격량",
		        mel.chk_errqty as "불량량",
		        mel.err_cd as "불량코드",
		        err.err_dtl as "불량내역",
		        chk.chk_insp as "상태"
		
		FROM 	mt_chk chk,
				mt_po po,
				mt mt,
				mt_podtl mpd,
				mt_errlist mel,
				err_code err,
		        vendor v
		
		WHERE	chk.po_dtlcd = mpd.po_dtlcd
		AND 	chk.mtrl_cd = mt.mt_cd
		AND 	mpd.po_cd = po.po_cd
		AND 	po.vdr_cd = v.vdr_cd
		AND		mel.po_dtlcd = mpd.po_dtlcd
		AND		mel.err_cd = err.err_cd
		<if test="startDate != null and endDate !=null">
		AND		chk.chk_dt BETWEEN TO_DATE(#{startDate}, 'YYYY-MM-DD') AND TO_DATE(#{endDate}, 'YYYY-MM-DD')
		</if>
		<if test="mtName != null and mtName = ''">
		AND 	mt.mt_nm LIKE '%' || {#mtName} || '%'
		</if>
	</select>
	<!-- 제품검사결과 검색 -->
	<select id="searchProdQuality" resultType="map">
		SELECT	per.prod_lot as "제품LOT",
				pid.prod_cd as "제품코드",
				ppr.proc_cd as "공정코드",
				pc.eq_cd as "설비코드",
				p.prod_nm as "제품명",
				ps.proc_qty as "생산량",
				ps.proc_passqty as "합격량",
				pe.err_qty as "불량량",
				pe.err_cd as "불량코드",
				err.err_dtl as "불량내역",
				ps.proc_st as "상태"
		
		FROM 	prod_err per,
				prod_lot plo,
				prd_insdtl pid,
				proc_prc ppr,
				process pc,
				prod p,
				proc_st ps,
				proc_err pe,
				err_code err
		
		WHERE 	per.prod_lot = plo.prod_lot
		AND 	ppr.prd_dtlcd = pid.prd_dtlcd
		AND 	ppr.proc_cd = pc.proc_cd
		AND 	pid.prod_cd = p.prod_cd
		AND 	ps.proc_prcd = ppr.proc_prcd
		AND 	ps.line_turn = ppr.line_turn
		AND 	ps.prd_dtlcd = ppr.prd_dtlcd
		AND 	pe.proc_prcd = ppr.proc_prcd
		AND 	pe.line_turn = ppr.line_turn
		AND 	pe.prd_dtlcd = ppr.prd_dtlcd
		AND 	pe.err_cd = err.err_cd
		<if test="prodName != null">
		AND		p.prod_nm LIKE '%' || {#prodName} || '%'
		</if>
	</select>
	<!-- 자재불량내역 검색 -->
	<select id="searchMtErrList" resultType="map">
		SELECT	mel.po_dtlcd as "발주상세코드",
				chk.chk_dt as "검사일자",
				v.vdr_nm as "업체명",
				mt.mt_nm as "자재명",
				mel.chk_errqty as "불량량",
				err.err_dtl as "불량내역",
				mpd.mt_prc as "단가"
		
		FROM 	mt_chk chk,
				mt_podtl mpd,
				mt_po po,
				vendor v,
				mt_errlist mel,
				err_code err,
				mt mt
		
		WHERE 	mel.po_dtlcd = mpd.po_dtlcd
		AND		mpd.po_cd = po.po_cd
		AND 	po.vdr_cd = v.vdr_cd
		AND 	mel.mtrl_cd = mt.mt_cd
		AND 	mel.err_cd = err.err_cd
		<if test="errDtl != null errDtl = ''">
		AND		err.err_dtl LIKE '%' || {#errDtl} || '%'
		</if>
		<if test="mtName != nul mtName = ''">
		AND 	mt.mt_nm LIKE '%' || {#mtName} || '%'
		</if>
	</select>
	<!-- 제품불량내역 검색 -->
	<select id="searchProdErrList" resultType="map">
		SELECT	per.prod_lot as "제품LOT",
				ppr.proc_cd as "공정코드",
				pe.line_turn as "순번",
				p.prod_nm as "제품명",
				per.chk_errqty as "불량량",
				pe.err_cd as "불량코드",
				err.err_dtl as "불량내역",
				ps.proc_st as "상태"
		
		FROM 	prod_err per,
				prod_lot plo,
				prd_insdtl pid,
				proc_prc ppr,
				proc_st ps,
				proc_err pe,
				err_code err,
				prod p
		
		WHERE	per.prod_lot = plo.prod_lot
		AND		pid.prod_cd = p.prod_cd
		AND 	ps.proc_prcd = ppr.proc_prcd
		AND 	ps.line_turn = ppr.line_turn
		AND 	ps.prd_dtlcd = ppr.prd_dtlcd
		AND 	pe.proc_prcd = ppr.proc_prcd
		AND 	pe.line_turn = ppr.line_turn
		AND 	pe.prd_dtlcd = ppr.prd_dtlcd
		AND 	pe.err_cd = err.err_cd
		<if test="errDtl != null and errDtl = ''">
		AND		err.err_dtl LIKE '%' || {#errDtl} || '%'
		</if>
		<if test="prodName != null and prodName = ''">
		AND 	p.prod_nm LIKE '%' || {#prodName} || '%'
		</if>
	</select>
	
	<!-- 입력 -->
	<!-- 자재 품질검사요청 -->
	<insert id="requestQualityM">
		
	</insert>
	<!-- 제품 품질검사요청 -->
	<insert id="requestQualityP">
		
	</insert>
	
	<!-- 수정 -->
	<!-- 자재 품질검사 -->
	<update id="resultQualityM">
		
	</update>
	<!-- 제품 품질검사 -->
	<update id="resultQualityP">
		
	</update>
</mapper>