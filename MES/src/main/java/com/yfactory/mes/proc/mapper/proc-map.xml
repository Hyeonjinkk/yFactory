<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yfactory.mes.proc.mapper.ProcMapper">
	<!-- 주문서 전체조회 -->
	<select id="ProcOrderSelectAll" resultType="map">
		SELECT ordtl.ordtl_cd
		"주문코드" ,
		TO_CHAR(ord.req_dt,'YYYY-MM-DD') "주문일자",
		TO_CHAR(ord.res_dt,'YYYY-MM-DD') "납기일자",
		ordtl.prod_cd "완제품코드" ,
		ordtl.ord_qty "주문수량",
		vdr.vdr_nm "업체명",
		pd.prod_nm "완제품명",
		cd.cd_explan
		"진행상황"

		FROM
		ORDERS ord,
		VENDOR vdr,
		ORD_DTL ordtl,
		PROD pd,
		COMM_CODE cd
		WHERE ord.vdr_cd = vdr.vdr_cd
		AND ord.ord_cd = ordtl.ord_cd
		AND
		ordtl.prod_cd
		= pd.prod_cd
		AND cd.comm_cd = ord.prog_cd
	</select>
	<!-- 주문서 단건조회 -->
	<select id="OrderSelectOk" resultType="map">
		SELECT ordtl.ordtl_cd
		"주문코드" ,
		TO_CHAR(ord.req_dt,'YYYY-MM-DD') "주문일자",
		TO_CHAR(ord.res_dt,'YYYY-MM-DD') "납기일자",
		ordtl.prod_cd "완제품코드" ,
		ordtl.ord_qty "주문수량",
		vdr.vdr_nm "업체명",
		pd.prod_nm "완제품명",
		cd.cd_explan
		"진행상황"
		FROM
		ORDERS ord,
		VENDOR vdr,
		ORD_DTL ordtl,
		PROD pd,
		COMM_CODE cd
		WHERE ord.vdr_cd = vdr.vdr_cd
		AND ord.ord_cd = ordtl.ord_cd
		AND
		ordtl.prod_cd
		= pd.prod_cd
		AND cd.comm_cd = ord.prog_cd
		AND
		ordtl.ordtl_cd = #{ordCd}
	</select>
	<!-- 제품 전체 조회 -->
	<select id="PrdSelect" resultType="map">
		SELECT PROD_CD "완제품코드",
		PROD_NM "완제품명"
		FROM PROD
	</select>
	<!-- 제품 단건 조회 -->
	<select id="PrdSelectOne" resultType="map">
		SELECT PROD_CD "완제품코드",
		PROD_NM "완제품명"
		FROM PROD
		WHERE PROD_CD = #{prodCd}
	</select>
	<!-- 생산 계획 전체조회 -->
	<select id="ProcPlanAll" resultType="map">
		SELECT pl.pp_cd "생산계획코드",
		pl.pp_nm "계획명",
		dtl.pd_cd "생산계획상세코드",
		pd.prod_nm "완제품명",
		TO_CHAR(pl.pp_dt,'YYYY-MM-DD') "계획일자",
		dtl.pd_qty "계획량"
		FROM PRDT_PL pl, PLAN_DTL dtl, PROD pd
		WHERE pl.pp_cd = dtl.pp_cd
		AND dtl.prod_cd = pd.prod_cd
	</select>
	<!-- 생산 계획 날짜조회 -->
	<select id="PrdtPlanSelect" resultType="map">
		SELECT pl.pp_cd "생산계획코드",
		pl.pp_nm "계획명",
		TO_CHAR(pl.pp_dt,'YYYY-MM-DD') "계획일자",
		dtl.pd_qty "계획량"
		FROM PRDT_PL pl, PLAN_DTL dtl
		WHERE pl.pp_cd = dtl.pp_cd
		<if test="date1 != '' and date2 != ''">
			AND pl.pp_dt BETWEEN TO_DATE(#{date1},'YY/MM/DD') AND TO_DATE(#{date2},'YY/MM/DD')
		</if>
	</select>
	<!-- 생산 계획 단건조회 -->
	<select id="ProcPlanSelect" resultType="map">
		SELECT
 		dtl.pp_cd "생산계획코드",
 		pl.pp_nm "계획명",
		pd.prod_nm "완제품명",
		pd.prod_cd "완제품코드",
		pl.ord_cd "주문코드",
		dtl.pd_qty "계획량",
		dtl.pd_dt "생산일수",
		dtl.pd_rank "작업우선순위"
		FROM PRDT_PL pl, PLAN_DTL dtl, PROD pd,ORDERS ord
		WHERE pl.pp_cd = dtl.pp_cd
		AND pl.ord_cd = ord.ord_cd
		AND dtl.prod_cd = pd.prod_cd
		AND dtl.pp_cd = #{ppCd}
	</select>
	<!--  생산계획조회 조건조회 -->
	<select id="ProcPlanSelectState" resultType="map">
        SELECT
	    dtl.pp_cd "생산계획코드",
        pl.pp_nm "계획명",
        dtl.pd_cd "생산계획상세코드",
		pd.prod_nm "완제품명",
		pd.prod_cd "완제품코드",
		dtl.pd_qty "계획량",
        dtl.pd_rank "작업우선순위",
		dtl.pd_dt "생산일수",
        pl.pp_prog "상태"  
        
		FROM PRDT_PL pl, PLAN_DTL dtl, PROD pd,ORDERS ord 
		WHERE pl.pp_cd = dtl.pp_cd
		AND pl.ord_cd = ord.ord_cd
		AND dtl.prod_cd = pd.prod_cd
		

	   <if test = "state == '진행'"> 
        AND  pl.pp_prog = 'PLAN01'	
        </if>
        <if test = "state == '완료'"> 
        AND  pl.pp_prog = 'PLAN02'
        </if>
        <if test = "state == '취소'"> 
        AND  pl.pp_prog = 'PLAN03'
        </if>
		<if test="prdNm != ''">
		AND pd.prod_nm = #{prdNm}
		</if>
		<if test="date1 != null and date2 != null">
			AND pl.pp_dt BETWEEN TO_DATE(#{date1},'YY/MM/DD') AND TO_DATE(#{date2},'YY/MM/DD')
		</if>
	</select>
		<!-- 생산 미지시계획 조회 -->
	<select id="NoPlanSelect" resultType="map">
       SELECT
       dtl.pp_cd "생산계획코드",
        pl.pp_nm "계획명",
        dtl.pd_cd "생산계획상세코드",
      pd.prod_nm "완제품명",
      pd.prod_cd "완제품코드",
      dtl.pd_qty "계획량",
        dtl.pd_rank "작업우선순위",
      dtl.pd_dt "생산일수",
        ins.ins_st "상태"

      FROM PRDT_PL pl, PLAN_DTL dtl, PROD pd, PRD_INS ins
      WHERE pl.pp_cd = dtl.pp_cd
      AND dtl.prod_cd = pd.prod_cd
      AND ins.pd_cd = dtl.pd_cd
      AND ins.pp_cd = dtl.pp_cd
      AND ins.ins_st = 'PRDT01'

		<!-- 상세 생산계획 조회  -->
	</select>
		<select id="procDtPlanSelect" resultType="map">
        SELECT
	    dtl.pp_cd "생산계획코드",
        pl.pp_nm "계획명",
        dtl.pd_cd "생산계획상세코드",
		pd.prod_nm "완제품명",
		pd.prod_cd "완제품코드",
		dtl.pd_qty "계획량",
        dtl.pd_rank "작업우선순위",
		dtl.pd_dt "생산일수"
        

		FROM PRDT_PL pl, PLAN_DTL dtl, PROD pd,ORDERS ord 
		WHERE pl.pp_cd = dtl.pp_cd
		AND pl.ord_cd = ord.ord_cd
		AND dtl.prod_cd = pd.prod_cd
		AND dtl.pd_cd = #{ppCd}
	</select>
		<!-- 상품코드 라인코드 조회 -->
		<select id="ProcLineSelect" resultType="map">
	  SELECT  li.line_cd "라인코드"
      FROM   LINE li, PROD pd
      WHERE li.prod_cd = pd.prod_cd
      AND     pd.prod_nm = #{prodNm}
		</select>
	<!--  필요자재(BOM) 조회 -->
	<select id="ProcNeedMtrl" resultType="map">
		SELECT P.PROD_CD "제품코드",
        	   B.MT_CD "자재코드", 
        	   M.MT_NM "자재명",
        	   B.CS_QTY "소모량",
               DTL.PRD_DTLCD "생산지시상세코드"
		FROM BOM B, MT M, PROD P, LINE LI, PRD_INSDTL DTL
		WHERE B.MT_CD = M.MT_CD
		AND B.PROD_CD = P.PROD_CD
        AND P.PROD_CD = DTL.PROD_CD
		AND LI.PROD_CD = P.PROD_CD
		AND LI.LINE_CD = #{line}
	</select>
	<!-- 필요자재(LOT) 조회-->
	<select id="ProcNeedMtrlLOT" resultType="map">
SELECT DTL.PRD_DTLCD "지시디테일코드",
          LOT.MT_LOT "자재LOT번호", 
          QTY.MT_QTY "현재고", 
          M.MT_NM "자재명",
          B.MT_CD "자재코드",
          TO_CHAR(LOT.MT_EXP, 'YYYY-MM-DD') "유통기한"
FROM PRD_INSDTL DTL, PROD P, BOM B, MT_LOT LOT, MT_CURQTY QTY, MT M 
WHERE DTL.PROD_CD = P.PROD_CD
AND P.PROD_CD = B.PROD_CD
AND B.MT_CD = M.MT_CD
AND M.MT_CD = LOT.MT_CD
AND LOT.MT_LOT = QTY.MT_LOT
AND M.MT_CD = #{mtNm}
AND DTL.PRD_DTLCD = #{dtlCd}

	</select>
	
	<!-- 생산지시 조회 -->
	<select id="ProcOrderSelect" resultType="map">
        SELECT ins.ins_cd "생산지시코드",
               pd.prod_cd "제품코드",
               pd.prod_nm "제품명",
               insdtl.ins_qty "생산수량",
               li.line_cd "라인코드",
               dtl.pd_rank "지시우선순위",
               cc.cd_nm "진행구분"
        FROM prd_ins ins, prod pd, prd_insdtl insdtl, line li, plan_dtl dtl,comm_code cc,PRDT_PL pl
        WHERE  insdtl.insdtl_st = cc.comm_cd
        AND    dtl.pp_cd = ins.pp_cd
        AND    dtl.pd_cd = ins.pd_cd
        AND    insdtl.ins_dtlcd = ins.ins_cd
        AND    pd.prod_cd = insdtl.prod_cd
        AND    pd.prod_cd = li.prod_cd
        AND    pl.pp_cd   = dtl.pp_cd
        
	   <if test = "state == '진행'"> 
         AND    cc.comm_cd = 'PRST01'
        </if>
        <if test = "state == '완료'"> 
      	 AND    cc.comm_cd = 'PRST02'
        </if>

		<if test="date1 != '' and date2 != ''">
		
			AND pl.pp_dt BETWEEN TO_DATE(#{date1},'YY/MM/DD') AND TO_DATE(#{date2},'YY/MM/DD')
		</if>

	</select>
	<select id="ProcOrderList" resultType="map">
	select ins.ins_cd "생산지시코드",
	pd.prod_nm "제품명",
	insdtl.ins_qty "생산수량",
	TO_CHAR(insdtl.ins_dtldt, 'YYYY-MM-DD') "생산지시일자"
	from PRD_INS ins, prod pd, PRD_INSDTL insdtl
	WHERE ins.ins_cd = insdtl.ins_dtlcd
	AND   insdtl.prod_cd = pd.prod_cd
		<if test="date1 != '' ">
	AND insdtl.ins_dtldt = TO_DATE(#{date1},'YY/MM/DD')
</if>
	</select>

	<select id="ProcOrderCdSelectOne" resultType="map">
	select DISTINCT ins.ins_cd "생산지시코드",
	pd.prod_nm "제품명",
    pd.prod_cd "제품코드",
	insdtl.ins_qty "생산수량",
    li.line_cd "라인코드"
	from PRD_INS ins, prod pd, PRD_INSDTL insdtl, LINE li
	WHERE ins.ins_cd = insdtl.ins_dtlcd
	AND   insdtl.prod_cd = pd.prod_cd
    AND   li.prod_cd = pd.prod_cd
    AND   ins.ins_cd = #{dtlCd}
	</select>
	<select id="ProcOrderLineSelectOne" resultType="map">
	SELECT PRC.PROC_PRCD "진행공정코드",
	PRC.PROC_CD "공정코드",
	 PC.PROC_NM "공정명", 
	 PC.EQ_CD "설비코드", 
	 EQ.EQ_NM "설비명",
	 EMP.EMP_NM "담당자"
	FROM PROC_PRC PRC, PROCESS PC, LINE LI, EQ EQ, EMPLOYEE EMP
	WHERE PRC.PROC_CD = PC.PROC_CD
	AND PRC.PROC_MGR = EMP.EMP_NO
	AND LI.PROC_CD = PC.PROC_CD
	AND PC.EQ_CD = EQ.EQ_CD
	AND LI.LINE_CD = #{line}
	</select>
	<insert id="ProcPlanInsert">

	</insert>
</mapper>