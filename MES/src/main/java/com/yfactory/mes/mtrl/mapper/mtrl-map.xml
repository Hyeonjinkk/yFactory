<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yfactory.mes.mtrl.mapper.MtrlMapper">
	<!-- 미지시 생산조회 -->
	<select id="selectPl" resultType="map">
		SELECT pl.pp_cd "pp_cd", 
       	       pl.pp_nm "pp_nm",
               pl.pp_dt "pp_dt",
               dtl.pd_qty "pd_qty"
		FROM   prdt_pl pl, plan_dtl dtl
		WHERE  pl.pp_cd = dtl.pd_cd
	</select>
	
	<!-- 자재lot재고조회 -->
	<select id="listMtrlLot" resultType="map">
		SELECT lot.mt_lot "mt_lot",
			   lot.mt_cd "mt_cd",
			   m.mt_nm "mt_nm", 
			   vd.vdr_nm "vdr_nm", 
			   cy.mt_qty "mt_qty", 
			   TO_CHAR(lot.mt_exp,'YYYY-MM-DD') "mt_exp"
		FROM   mt_lot lot, 
			   mt m,  
			   vendor vd, 
			   mt_curqty cy
		WHERE  m.mt_cd = lot.mt_cd
		AND    m.ven_cd = vd.vdr_cd
		AND    lot.mt_lot = cy.mt_lot
	</select>
	
	<!-- LOT 검색조회 -->
	<select id="lotSelectSearch" resultType="map">
		SELECT  lot.mt_lot "mt_lot",
			    lot.mt_cd "mt_cd",
			    m.mt_nm "mt_nm", 
			    vd.vdr_nm "vdr_nm", 
			    cy.mt_qty "mt_qty", 
			    TO_CHAR(lot.mt_exp,'YYYY-MM-DD') "mt_exp"
		FROM    mt_lot lot, 
			    mt m,  
			    vendor vd, 
			    mt_curqty cy
		WHERE   m.mt_cd = lot.mt_cd
		AND     m.ven_cd = vd.vdr_cd
		AND     lot.mt_lot = cy.mt_lot
			<if test="m1 != ''">
		AND m.mt_nm LIKE '%'||#{m1}||'%'
			</if>
			<if test="m2 != ''">
		AND vd.vdr_nm LIKE '%'||#{m2}||'%'
			</if>
			<if test="req1 != '' and req2 != ''">
		AND lot.mt_wdt between TO_DATE(#{req1},'YYYY-MM-DD') AND TO_DATE(#{req2},'YYYY-MM-DD')
			</if>
	</select>
	
	<!-- 자재 코드,이름 전체조회 -->
	<select id="mtcdList" resultType="map">
		SELECT mt_nm "mt_nm", 
			   mt_cd "mt_cd"
		FROM   mt
	</select>
	
	<!-- 자재명 단건조회 -->
	<select id="mtnmSelectSearch" resultType="map">
		SELECT mt_nm "mt_nm", 
			   mt_cd "mt_cd"
		FROM   mt
		WHERE  mt_nm LIKE '%'||#{mtnm}||'%'
	</select>
	
	<!-- 업체명 조회 -->
	<select id="vendorList" resultType="map">
		SELECT cd.cd_nm "cd_nm",
      		   vd.vdr_nm "vdr_nm", 
       		   vd.vdr_cd "vdr_cd"
		FROM   vendor vd, COMM_CODE cd
		WHERE  vd.ven_cd = cd.comm_cd
	</select>
	
	<!-- 업체명 단건조회 -->
	<select id="vdrnmSelectSearch" resultType="map">
		SELECT cd.cd_nm "cd_nm",
      		   vd.vdr_nm "vdr_nm", 
       		   vd.vdr_cd "vdr_cd"
        FROM   vendor vd, COMM_CODE cd
        WHERE  vd.ven_cd = cd.comm_cd
        AND    vd.vdr_nm LIKE '%'||#{vdrnm}||'%'		   
	</select>

	
</mapper>